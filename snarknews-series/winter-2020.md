# SnarkNews Winter Series 2020

## Round 1

+ [ ] [Антивирусы: начало](https://contest.yandex.ru/snws2020/contest/16518/problems/A/)
+ [x] [Шифровальщик](https://contest.yandex.ru/snws2020/contest/16518/problems/B/)
+ [x] [Две лаборатории](https://contest.yandex.ru/snws2020/contest/16518/problems/C/)
+ [x] [Уязвимость в микрокоде](https://contest.yandex.ru/snws2020/contest/16518/problems/D/)
+ [x] [Антивирусы и параллелизм](https://contest.yandex.ru/snws2020/contest/16518/problems/E/)
+ [x] [Крипточервь](https://contest.yandex.ru/snws2020/contest/16518/problems/F/)

### A. Антивирусы: начало

题意：给出一个字符串$S$，然后有另外$N$个字符串$s_1,s_2,\dots,s_N$，一开始都是空串。有$Q$个操作，

+ 给出区间$[l,r]$和一个字符串$T$，给区间里的字符串都append一个$T$。
+ 询问区间$[l,r]$里有多少字符串以$S$结尾。

$1 \le |S| \le 20, 1 \le |T| \le 10, 1 \le N, Q \le 10^5, 1 \le l \le r \le N$

题解：把$S$的KMP数组建出来，考虑用KMP匹配的过程，对于每个串实际上只需要维护当前匹配到$S$的哪个位置即可。对于每个字符$c$，我们可以预处理一个数组$p_c(i)$表示当前匹配到$S$的位置$i$，如果再加入一个字符$c$，会匹配到的位置。

我们可以用线段树维护当前区间里匹配到$i$的字符串个数$cnt(i)$，然后第一个操作其实就是对$cnt$数组操作一下。而且$p_c$显然是可以复合的，于是也就可以打标记了。

### B. Шифровальщик

题意：有一个$n \times m$的字符矩阵，另外有个长度为$k$的字符串$s$。你每次可以选择一列循环下移。求最少操作次数使得$s$在某一行中出现。

$1 \le n,m,k \le 500$

题解：处理出$cnt_c(i,j)$表示字符$c$要出现在$(i,j)$的最小次数。然后就枚举$s$在那个位置出现即可。

### C. Две лаборатории

题意：平面上有$N$个点，第$i$个点坐标为$(x_i,y_i)$。你需要找出两个整点$(x_a,y_a)$和$(x_b,y_b)$使得：

+ 最多只有一个点和$(x_a,y_a)$以及$(x_b,y_b)$的距离一样
+ 距离$(x_a,y_a)$比较近的点个数和距离$(x_b,y_b)$比较近的点个数一样

$2 \le N \le 10^5, -10^9 \le x_i, y_i \le 10^9, -10^{18} \le x_a,y_a,x_b,y_b \le 10^{18}
$

题解：如果我们能够找出一条直线能够把这些点分在两侧，那么这个题实际上就做完了，只要取和这条直线垂直的两个点即可。

首先把所有点按照先$x$坐标后$y$坐标的方式排序。然后拿出处于中位数的点作为直线的中点，直接构造即可。

### D. Уязвимость в микрокоде

题意：给出$N$，$K$和$P$，求出有多少个长度为$N$的数组$C$，对$P$取模，满足：

+ $1 \le C_i \le K$

+ 存在两个数$a$和$b$，使得$2 \le a < b \le N$并且$C_a+C_{b-1}=C_b+C_{a-1}$。

$3 \le N \le 10^5, 1 \le K \le 10, 10^8+7 \le P \le 10^9 + 7$，$P$是质数

题解：化简一下就是$C_a-C_{a-1}=C_b-C_{b-1}$，即相邻两项的差。显然这个差最多只有$2K-1$个。

当$N \ge 2K$的时候，所有序列都是可行的。否则$N < 2K$，考虑$O(2^{2K} \cdot N)$的dp即可。

### E. Антивирусы и параллелизм

题意：给出一棵$N$个点的有根树，$1$是根节点，还有个$1$到$N$的排列$P$。你需要把$P$划分成恰好$K$份，每份的代价是这些点LCA的深度。求代价和最小的划分。

$1 \le K \le N \le 300000, NK \le 300000, 1 \le P_i \le N$

题解：先用ST表预处理一下，配合$O(1)$ LCA的话，做到可以$O(1)$查询一段区间的代价。之后令$dp(i,j)$表示把前$j$个数划分成$i$份的最小代价。容易证明这个转移满足决策单调性，直接用$O(N \log N)$的决策单调性即可。

复杂度$O(NK \log N)$。

### F. Крипточервь

题意：有一个$N$面的骰子，每次等概率掷出$1$到$N$某个数。你可以掷最多$K$次，求最优策略下期望能够掷出的最大值。

$1 \le N, K \le 100$

题解：$dp(i) = \frac{1}{N} \sum_{x=1}^{N} \max(x, dp(i-1))$，取$dp(1..N)$的最大值即可。

## Round 2

- [x] [A. Социологическое исследование](https://contest.yandex.ru/snws2020/contest/16519/problems/A/)
- [x] [B. Агитационный стенд](https://contest.yandex.ru/snws2020/contest/16519/problems/B/)
- [x] [C. План кампании](https://contest.yandex.ru/snws2020/contest/16519/problems/C/)
- [x] [D. Отдалённый район](https://contest.yandex.ru/snws2020/contest/16519/problems/D/)
- [x] [E. Новый микрорайон](https://contest.yandex.ru/snws2020/contest/16519/problems/E/)
- [x] [F. Сейф в офисе конкурентов](https://contest.yandex.ru/snws2020/contest/16519/problems/F/)

### A. Социологическое исследование

题意：给出$n$个数$a_1,a_2,\dots,a_n$。找一个$k$，使得$(a_1^2+a_2^2+\dots+a_k^2) \cdot (a_{k+1}+a_{k+2}+\dots+a_n)$最大。

$1 \le n \le 10^5, 1 \le a_i \le 100$

题解：略

### B. Агитационный стенд

题意：给出平面上$n$个点$(x_1,y_1),(x_2,y_2),\dots,(x_n,y_n)$，保证任意两个点的$x$坐标和$y$坐标都互不相同。询问有多少点对$(p_i,p_j)$使得$p_i$在$p_j$的左下角，求这两个点构成的矩形里面没有其他点。

$1 \le n \le 10^5, 1 \le x_i, y_i \le n, x_i \ne x_j, y_i \ne y_j$

题解：先按照$x$坐标排序，然后考虑分治。考虑固定左半边一个点$p$后，然后右半边只保留$y$坐标比$p.y$大的点，然后可以发现能够产生贡献的点一定是随着$x$坐标变大， $y$坐标变小的。

同样如果左半边存在一个点$q$在$p$的右边且$q.y$坐标$p.y$，那么实际上是给右边点的$y$坐标设定了一个上界。如果我们能够求出这个上界，并且求出右边所有有用的点，那么二分一下就知道答案了。

考虑按照$y$从大到小依次加入每个点，那么对右半边点维护一个单调栈$SR$，里面点$x$单调递增。同时对左半边点也维护一个单调栈$SL$，里面点$x$单调递减。

那么考虑一个新加入的左半边点$p$，我们把$y$大于$p.y$的右半边点全部加入单调栈$SR$中，就可以顺利维护出所有可能产生贡献的点。同时把$p$加入单调栈$SL$中也可以顺利求出上界。

复杂度$O(n \log^2 n)$。

### C. План кампании

题意：给一个仅包含`m`和`w`的字符串$s$，求出最少删掉几个字符，才能使：`m`个数和`w`个数一样并且每个前缀`w`个数不少于`m`个数。

$1 \le |s| \le 10^3$

题解：略

### D. Отдалённый район

题意：$N$个点$M$条边的无向图，每个点有个权值$v_i$。你要选择一个起点和一个终点，然后给每条边定向，以后只能沿着这个方向走，使得经过点的点权之和最大（同一个点只算一次）。

$2 \le N \le 10^5, 1 \le M \le 2 \times 10^5, 1 \le v_i \le 100$

题解：对于一个双联通图，我们一个可以给边定向使得这个图变成强连通。于是可以求出双联通分量，然后变成一棵树，就是找树的直径。

### E. Новый микрорайон

题意：有$N$个点的二叉树，节点$i$的父亲是$\lfloor \frac{i}{2} \rfloor$。一开始节点$i$的权值是$i$。现在有$q$个操作：

+ `1 r n`：把节点$r$的权值改成$n$
+ `2 r`：求出经过节点$r$的最长路径

$1 \le N \le 10^8, 1 \le Q \le 20000, 1 \le r \le N, 1 \le n \le 10^{10}$

题解：每个点维护向下最长的路径即可。

### F. Сейф в офисе конкурентов

题意：有$n$个数，每次操作可以加一或者减一。你需要恰好操作$m$次，使得每个数都是质数，求出一个操作方案。

$1 \le n \le 10^5, 0 \le a_i \le 10^6, 0 \le m \le 10^9$

题解：求出每个位置变成质数需要的最少奇数次数和偶数次数。然后先算出最小步数，如果奇偶性一样就解决了，否则挑一个奇偶步数差最小的换一下。

## Round 3

+ [x] [A. Железнодорожное кольцо](https://contest.yandex.ru/snws2020/contest/16520/problems/A/)
+ [x] [B. Проездные](https://contest.yandex.ru/snws2020/contest/16520/problems/B/)
+ [x] [C. Выигрышные железнодорожные билеты](https://contest.yandex.ru/snws2020/contest/16520/problems/C/)
+ [x] [D. Дизайн вагонов](https://contest.yandex.ru/snws2020/contest/16520/problems/D/)
+ [x] [E. Монорельс](https://contest.yandex.ru/snws2020/contest/16520/problems/E/)
+ [x] [F. Слишком креативный андроид](https://contest.yandex.ru/snws2020/contest/16520/problems/F/)

### A. Железнодорожное кольцо

题意：有一个$n$站的环形铁路，第$i$站和第$i+1$站距离为$d_i$，其中$d_n$是第$n$站和第$1$站距离。有$m$趟火车，第$j$趟在时刻$0$从第$d_j$站出发，沿着顺时针或者逆时针不断绕圈，每$t_j$秒走一单位距离。现在有$q$个询问，每次给出一个起点$x_i$和终点$y_i$，求出再时刻$0$从$x_i$出发最早什么时候到达$y_i$。

$3 \le n \le 10^5, 1 \le m, q \le 10^5, 1 \le d_i \le 100, 1 \le b_j \le n, 1 \le t_j \le 10^5, 1 \le x_i, y_i \le n$

题解：先只考虑沿顺时针前进的火车。令$s(i)$表示从$i$到沿着顺时针走到$1$的长度。考虑$x，y$和$b$的关系可以分成以下几种情况：

+ $x < y$且$d \le x$，那么我们要求$s(b)t-s(y)t$的最小值
+ $x < y$且$d > x$，那么我们要求$(s(b)+s(1))t-s(y)t$的最小值
+ $x > y$且$d < x$，那么我们要求$(s(b)+s(1))t-s(y)t$的最小值
+ $x > y$且$d > x$，那么我们要求$(s(b)+2s(1))t-s(y)t$的最小值

离线，然后用一个动态凸壳的板子就好了。逆时针也是类似的。

### B. Проездные

题意：有$n$个数$a_1,a_2,\dots,a_n$。现在给你$2^n$个子集和，要求构造这$n$个数。

$1 \le n \le 18, 0 \le p \le 2^{18}$

题解：考虑排序，那么第一个肯定要是$0$，然后$a_1$肯定是第二个数。然后考虑$x$和$x+a_1$肯定是成对出现的，从小到大或者从大到小枚举$x$即可，就可以把除去$a_1$的子集和找出来。用类似的方法继续做。

### C. Выигрышные железнодорожные билеты

题意：给出$L$，$R$和$K$，求出区间$[L, R]$里满足下面条件的数的和：$K$是这个数除去$1$以外的最小约数。

$1 \le L, R \le 10^{11}, 2 \le K \le 10^{11}$

题解：转成求$[1,N]$里面最小质因子是$K$的数的和，考虑$O(n^{\frac{3}{4}})$的质数计数算法，$f(n,i)$表示表示$[1,n]$里是质数或者最小质因子不小于$p_i$的$n$的和，显然有以下容斥：

$$
f(n,i)=f(n,i-1)-(f(n/p_i,i-1)-f(p_i-1,i-1))p_i
$$

假设$k$是第$m$个质数，那么答案就是$f(n,m)-f(n,m+1)$。

### D. Дизайн вагонов

题意：有一个无限长的纸条，有$n$个人依次操作，第$i$个人会把从起点开始长度为$l_i$的部分染色成$i$。每次求出现在有多少颜色还能被看见。

$1 \le n \le 10^5, 1 \le l_i \le 10^9$

题解：单调栈维护即可

### E. Монорельс

题意：给出$n$个长度$l_1,l_2,\dots,l_n$，需要构造出两个多边形，每个长度都需要用上，使得周长之差最少。

$1 \le n \le 40, 1 \le l_i \le 100$

题解：能够构成多边形的话，要求周长要大于两倍的最大边。先从大到小排序，假设第一个数属于第一个多边形，然后枚举$l_x$属于第二个多边形。令$dp(i,j)$表示用了剩下$i$个数，当前第一个周长减第二个周长是$j$的情况下，第一个多边形的最长周长。转移就是枚举这条边属于哪个多边形即可。注意只要$l_i \le l_x$的才可以属于第二个多边形。

### F. Слишком креативный андроид

题意：给出$n$个点$m$条边的DAG，求出哪些点在所有拓扑排序的都处于同一个位置。

$1 \le n \le 10^5, 0 \le m \le 10^5$

题解：一个点$u$合法，当且仅当对于所有的点$v$，要么$u$能到$v$，要么$v$能到$u$。我们随便找出一个拓扑排序$p_1,p_2,\dots,p_n$。考虑枚举点$p_u$，如果存在一个$v < u$，$p_v$不能到达$p_u$，那么这个$u$肯定是不合法的。反过来如果存在一个$v > u$，$p_v$不能到达$p_u$，那么$u$肯定也是不合法的。

那么我们枚举$p_v$，找出最小的$x > v$，使得$p_v$和$p_x$之间有边。那么显然$u \in [v+1,x-1]$的$u$都是不合法的。同样找出最大的$y < v$，使得使得$p_v$和$p_y$之间有边，$u \in [y+1,v-1]$的$u$也都是不合法的。

## Round 4

- [x] [A. Два хода ладьи](https://contest.yandex.ru/snws2020/contest/16521/problems/A/)
- [x] [B. Чемпионы сложения](https://contest.yandex.ru/snws2020/contest/16521/problems/B/)
- [ ] [C. Луч света в зеркальном царстве](https://contest.yandex.ru/snws2020/contest/16521/problems/C/)
- [x] [D. А теперь умножение!](https://contest.yandex.ru/snws2020/contest/16521/problems/D/)
- [ ] [E. Захвати дерево](https://contest.yandex.ru/snws2020/contest/16521/problems/E/)
- [x] [F. Очки за поля](https://contest.yandex.ru/snw    s2020/contest/16521/problems/F/)

### A. Два хода ладьи

题意：有一个边长为$6$的六边形网格，给出其中两个点，求用两步从第一个点走到第二个点的方案数。每次走能够沿直线前进若干步。

题解：枚举第一步走哪里，然后判定第二步是否可走到即可。

### B. Чемпионы сложения

题意：给出两个十进制数的Run Length Encoding，求出这两个数加起来后的Run Length Encoding。

$1 \le N_1, N_2 \le 100, 1 \le n_i \le 10^{18}, 0 \le d_i \le 9$

题解：直接做加法即可，考虑一堆数一起进位。

### C. Луч света в зеркальном царстве

题意：有$n$面镜子构成了一个凸多边形，第$i$个顶点为$(x_i,y_i)$，第$i$面镜子的反射率为$k_i$。在$(0,0)$处有个人沿着$(V_x,V_y)$方向发射了一束强度为$1$的光，求出光在消失前反射了几次。

强度为$x$的光经过反射率为$k$的镜子后，强度变为$kx$。强度小于$10^{-4}$后光会消失。如果光射入凸包顶点，光也会消失。

$1 \le n \le 1000, -10^9 \le x_i, y_i \le 10^9, 0 \le k_i \le 0.9, -10^9 \le V_x, V_y \le 10^9$，每个数最多给出小数点后$4$位。

题解：暴力几何模拟题。每次求出在哪条边反射，然后做出关于这条边的对称点，即完成了一次反射。依次类推下去，知道光消失。

### D. А теперь умножение!

题意：给出一个质数$P$和$G$和$L$个整数$T_1,T_2,\dots,T_N$。从$1$出发，每次可以乘上一个$T_i$，求出能否在有限步使得得到的数对$P$取模后是$G$。

$2 \le P < 2^{31}, 1 \le L \le 10^5, 0 \le T_i, G < P$

题解：假设可以求出$T_1,T_2,\dots,T_N$能够表示的所有数$A$，然后也求出$T_1,T_2,\dots,T_N,G$能表示的所有数$B$。如果$|A| == |B|$，那么显然是可行的，否则是不可行的。

令$order(x)=\min(\{k|x^k \equiv 1 \pmod p\})$，那么$|A|=\text{lcm}(order(T_1), order(T_2), \dots, order(T_N))$。

因此我们只需要求出$order(x)$，显然$order(x)$一定是$p-1$的约数。考虑$m$的每个质因子$d$，挨个去掉，如果还满足$x^{\frac{m}{d}} equiv 1 \pmod p$，那么就可以把$m$变成$\frac{m}{d}$。

预处理$p-1$的质因子，那么求$order(x)$的复杂度就是$log(p)$的。

### E. Захвати дерево

题意：有一棵$N$个点的树，两个人玩游戏。第一个人一开始在$A$点，第二个人在$B$点。轮流走，每次可以移动到相邻的没有被访问过的位置，不能移动的输。求出有多少$(A,B)$，能够使得先手胜利。

$2 \le N \le 2000$

题解：对于一对$(A, B)$，考虑如下两种情况：

+ $A$不往$A \to B$方向走，那么需要找一条$A$出发的不沿$A \to B$方向走的最长路$d_A$，然后同样求出$B$出发，不经过点$A$的最长路$d_B$。如果$d_A > d_B$，那么这个时候是先手胜利的。
+ $A$往$A \to B$方向走了一步，这时候考虑$B$的操作：
  + $B$不往$B \to A$方向走，这时候$B$一定发现它走出的最长路大于等于$A$出发的最长路，于是先手必败。
  + $B$往$B \to A$方向走了一步，考虑$dp(u_a \to v_a, u_b \to v_b)$表示从先手从$u_a$走到了$v_a$，后手从$u_b$走到了$v_b$，当前先手操作的情况下能否获胜。这个时候其实$A$有两种选择，之后$B$也有两种选择，和上述分析的类似。你还需要处理出从一个点出发的最长路，次长路，次次长路。也需要处理出，删掉一条边后从一个点出发的最长路和次长路。只有就可以进行转移了。

### F. Очки за поля

题意：一个$n \times m$个地图，有五选手会在田地放置带颜色的小人标记自己的领地，分别`RYGBK`表示。有些位置是空地，用`?`表示，有些位置是路，用`+`表示。有些位置是城市，用`#`表示。有些位置是田地，用`.`表示。

现在会给每个相同类型的连通块计分，每个连通块的分数会给小人最多的那个选手。对于城市或者道路，分数为连通块大小。对于田地，每个和这些田地相邻的城市连通块都会加$3$分。求出哪些人获得了最高分。

$1 \le n, m \le 1000$

题解：只有田地有归属，那么求出田地连通块，算出这个田地的分数，然后加到对应的选手上即可。

## Round 5

- [x] [A. Профиль трассы](https://contest.yandex.ru/snws2020/contest/16522/problems/A/)
- [x] [B. Гонки на снегоходах](https://contest.yandex.ru/snws2020/contest/16522/problems/B/)
- [x] [C. Стрельба](https://contest.yandex.ru/snws2020/contest/16522/problems/C/)
- [x] [D. Собачьи упряжки](https://contest.yandex.ru/snws2020/contest/16522/problems/D/)
- [x] [E. Сноуборд](https://contest.yandex.ru/snws2020/contest/16522/problems/E/)
- [ ] [F. Снежный кросс](https://contest.yandex.ru/snws2020/contest/16522/problems/F/)

### A. Профиль трассы

题意：有个$R \times C$的矩阵，给出$R$个数$x_1,x_2,\dots,x_R$，表示第$i$行里的最大值。还有$C$个数$y_1,y_2,\dots,y_C$，表示第$i$列里的最大值。求出是否存在这样的矩阵。

$1 \le R, C \le 100, 0 \le x_i, y_i \le 1000$

题解：令$a_{i,j}=\min(x_i,y_j)$，之后求出实际的$x$和$y$，判定是否一样即可。

### B. Гонки на снегоходах

题意：给出$K$，构造一个$N$个点$M$条边的无向图，使得$1$到$2$的简单路径条数恰好是$K$。

$1 \le K \le 10^6, 2 \le N \le 100, 1 \le M \le 100$

题解：先构造出$2i - 2i+2$，$2i - 2i+1$和$2i+1 - 2i+2$，然后$1$到$2i$连边会增加$2^{i-1}$个路径。

### C. Стрельба

题意：有$N$个点$(x_i,y_i)$，速度是$v_i$，方向是$(dx_i,dy_i)$。你要选择一个点，求出从这个点开始以速度$V$追上第$i$个点的时间。你需要最小化这个时间的最大值。

$2 \le N, V \le 100, -100 \le x_i, y_i, dx_i, dy_i \le 100, 1 \le v_i \le 100$

题解：二分时间之后，变成给出$N$个圆判定是否存在交点。可以$O(N^2)$判定或者$O(N \log X)$判定。

### D. Собачьи упряжки

题意：有$N$个数$C_1,C_2,\dots,C_N$，然后有$Q$个操作：

+ 把$C_i,C_{i+1},\dots,C_j$里每个数都加上$k$。
+ 求出$\sum_{t=i}^{j} \min(C_t,k)$，并且把$C_t$设置为$\max(0,C_t-k)$

$1 \le N,Q \le 10^5, 0 \le C_i \le 10^5, 1 \le k \le 1000$

题解：裸segment tree beats.

### E. Сноуборд

题意：给出一个表达式，去掉了加号和乘号，只保留了数字和括号。保证括号两侧是用来隔离加号和乘号的。求出这个表达式的值。

$1 \le n \le 300000, 0 \le a_i \le 1234567890$

题解：直接那个栈模拟即可，根据栈里元素个数可以确定用乘法还是加法。

### F. Снежный кросс

题意：$N \times M$的地图，有空地用`.`表示，有雪地用`X`表示，有融雪的枪用`B`表示。从$(1,1)$出发，要到$(N,M)$去，每次可以做如下操作：

+ 走到一个相邻的空地或者有枪的格子。如果有枪，枪被拿走，这个格子变成空地。
+ 走到一个相邻的雪地，消耗一单位能量，这个雪地之后变成空地。
+ 如果至少有一把枪，那么可以选择一个方向，清空这个方向的雪。这把使用过的枪会消失。这个操作不消耗任何能量。

求出最少消耗量。

$2 \le H, W \le 1000$

题解：
